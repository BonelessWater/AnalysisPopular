2025-05-21 00:02:32,772 - INFO - Starting bank profitability analysis pipeline with error handling
2025-05-21 00:02:34,552 - ERROR - Missing required packages: scikit-learn
2025-05-21 00:02:34,552 - INFO - Installing missing packages...
2025-05-21 00:02:36,381 - INFO - Successfully installed missing packages
2025-05-21 00:02:36,382 - INFO - Data file already exists at data/raw/customer_data.csv
2025-05-21 00:02:36,391 - INFO - Data file verified: 1000 rows, 32 columns
2025-05-21 00:02:36,392 - INFO - Available columns: ['customer_id', 'age', 'sex', 'marital_status', 'dependents', 'education_level', 'employment_status', 'annual_income', 'residential_status', 'years_with_bank', 'num_active_accounts', 'avg_balance', 'total_deposits', 'transaction_frequency', 'digital_ratio', 'credit_utilization', 'overdraft_count', 'fee_revenue', 'credit_score', 'open_credit_lines', 'delinquency_count', 'total_loan_amount', 'ltv_ratio', 'ever_defaulted', 'branch_visits', 'call_center_calls', 'complaints', 'digital_logins', 'rfm_score', 'cross_sell_index', 'churn_risk_score', 'net_profit']
2025-05-21 00:02:36,393 - INFO - Running bank_profitability_pipeline.py
2025-05-21 00:02:38,365 - ERROR - Error running bank_profitability_pipeline.py (attempt 1/3)
2025-05-21 00:02:38,365 - ERROR - Return code: 1
2025-05-21 00:02:38,365 - ERROR - Error output: Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\pandas\core\indexes\base.py", line 3805, in get_loc
    return self._engine.get_loc(casted_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7081, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7089, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'customer_id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\sklearn\utils\_indexing.py", line 364, in _get_column_indices
    col_idx = all_columns.get_loc(col)
              ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    raise KeyError(key) from err
KeyError: 'customer_id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\domdd\Documents\GitHub\AnalysisPopular\bank_profitability_pipeline.py", line 265, in <module>
    main()
  File "C:\Users\domdd\Documents\GitHub\AnalysisPopular\bank_profitability_pipeline.py", line 253, in main
    reg_model, class_model, binary_model = train_models(df, preprocessor)
                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\domdd\Documents\GitHub\AnalysisPopular\bank_profitability_pipeline.py", line 130, in train_models
    reg_model.fit(X_train, y_reg_train)
  File "C:\Python312\Lib\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\sklearn\pipeline.py", line 654, in fit
    Xt = self._fit(X, y, routed_params, raw_params=params)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\sklearn\pipeline.py", line 588, in _fit
    X, fitted_transformer = fit_transform_one_cached(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\joblib\memory.py", line 312, in __call__
    return self.func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\sklearn\pipeline.py", line 1551, in _fit_transform_one
    res = transformer.fit_transform(X, y, **params.get("fit_transform", {}))
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\sklearn\compose\_column_transformer.py", line 993, in fit_transform
    self._validate_column_callables(X)
  File "C:\Python312\Lib\site-packages\sklearn\compose\_column_transformer.py", line 552, in _validate_column_callables
    transformer_to_input_indices[name] = _get_column_indices(X, columns)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\sklearn\utils\_indexing.py", line 372, in _get_column_indices
    raise ValueError("A given column is not a column of the dataframe") from e
ValueError: A given column is not a column of the dataframe

2025-05-21 00:02:40,371 - INFO - Retry attempt 1 for bank_profitability_pipeline.py
2025-05-21 00:02:42,680 - ERROR - Error running bank_profitability_pipeline.py (attempt 2/3)
2025-05-21 00:02:42,680 - ERROR - Return code: 1
2025-05-21 00:02:42,681 - ERROR - Error output: Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\pandas\core\indexes\base.py", line 3805, in get_loc
    return self._engine.get_loc(casted_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7081, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7089, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'customer_id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\sklearn\utils\_indexing.py", line 364, in _get_column_indices
    col_idx = all_columns.get_loc(col)
              ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    raise KeyError(key) from err
KeyError: 'customer_id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\domdd\Documents\GitHub\AnalysisPopular\bank_profitability_pipeline.py", line 265, in <module>
    main()
  File "C:\Users\domdd\Documents\GitHub\AnalysisPopular\bank_profitability_pipeline.py", line 253, in main
    reg_model, class_model, binary_model = train_models(df, preprocessor)
                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\domdd\Documents\GitHub\AnalysisPopular\bank_profitability_pipeline.py", line 130, in train_models
    reg_model.fit(X_train, y_reg_train)
  File "C:\Python312\Lib\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\sklearn\pipeline.py", line 654, in fit
    Xt = self._fit(X, y, routed_params, raw_params=params)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\sklearn\pipeline.py", line 588, in _fit
    X, fitted_transformer = fit_transform_one_cached(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\joblib\memory.py", line 312, in __call__
    return self.func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\sklearn\pipeline.py", line 1551, in _fit_transform_one
    res = transformer.fit_transform(X, y, **params.get("fit_transform", {}))
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\sklearn\compose\_column_transformer.py", line 993, in fit_transform
    self._validate_column_callables(X)
  File "C:\Python312\Lib\site-packages\sklearn\compose\_column_transformer.py", line 552, in _validate_column_callables
    transformer_to_input_indices[name] = _get_column_indices(X, columns)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\sklearn\utils\_indexing.py", line 372, in _get_column_indices
    raise ValueError("A given column is not a column of the dataframe") from e
ValueError: A given column is not a column of the dataframe

2025-05-21 00:02:44,682 - INFO - Retry attempt 2 for bank_profitability_pipeline.py
2025-05-21 00:02:46,653 - ERROR - Error running bank_profitability_pipeline.py (attempt 3/3)
2025-05-21 00:02:46,654 - ERROR - Return code: 1
2025-05-21 00:02:46,654 - ERROR - Error output: Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\pandas\core\indexes\base.py", line 3805, in get_loc
    return self._engine.get_loc(casted_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7081, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7089, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'customer_id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\sklearn\utils\_indexing.py", line 364, in _get_column_indices
    col_idx = all_columns.get_loc(col)
              ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    raise KeyError(key) from err
KeyError: 'customer_id'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\domdd\Documents\GitHub\AnalysisPopular\bank_profitability_pipeline.py", line 265, in <module>
    main()
  File "C:\Users\domdd\Documents\GitHub\AnalysisPopular\bank_profitability_pipeline.py", line 253, in main
    reg_model, class_model, binary_model = train_models(df, preprocessor)
                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\domdd\Documents\GitHub\AnalysisPopular\bank_profitability_pipeline.py", line 130, in train_models
    reg_model.fit(X_train, y_reg_train)
  File "C:\Python312\Lib\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\sklearn\pipeline.py", line 654, in fit
    Xt = self._fit(X, y, routed_params, raw_params=params)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\sklearn\pipeline.py", line 588, in _fit
    X, fitted_transformer = fit_transform_one_cached(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\joblib\memory.py", line 312, in __call__
    return self.func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\sklearn\pipeline.py", line 1551, in _fit_transform_one
    res = transformer.fit_transform(X, y, **params.get("fit_transform", {}))
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\sklearn\compose\_column_transformer.py", line 993, in fit_transform
    self._validate_column_callables(X)
  File "C:\Python312\Lib\site-packages\sklearn\compose\_column_transformer.py", line 552, in _validate_column_callables
    transformer_to_input_indices[name] = _get_column_indices(X, columns)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\sklearn\utils\_indexing.py", line 372, in _get_column_indices
    raise ValueError("A given column is not a column of the dataframe") from e
ValueError: A given column is not a column of the dataframe

2025-05-21 00:02:46,654 - ERROR - Failed to run bank_profitability_pipeline.py after 3 attempts
2025-05-21 00:02:46,654 - ERROR - Main pipeline failed. Exiting.
2025-05-21 00:03:30,444 - INFO - Starting bank profitability analysis pipeline with error handling
2025-05-21 00:03:31,732 - ERROR - Missing required packages: scikit-learn
2025-05-21 00:03:31,733 - INFO - Installing missing packages...
2025-05-21 00:03:33,655 - INFO - Successfully installed missing packages
2025-05-21 00:03:33,655 - INFO - Data file already exists at data/raw/customer_data.csv
2025-05-21 00:03:33,665 - INFO - Data file verified: 1000 rows, 32 columns
2025-05-21 00:03:33,666 - INFO - Available columns: ['customer_id', 'age', 'sex', 'marital_status', 'dependents', 'education_level', 'employment_status', 'annual_income', 'residential_status', 'years_with_bank', 'num_active_accounts', 'avg_balance', 'total_deposits', 'transaction_frequency', 'digital_ratio', 'credit_utilization', 'overdraft_count', 'fee_revenue', 'credit_score', 'open_credit_lines', 'delinquency_count', 'total_loan_amount', 'ltv_ratio', 'ever_defaulted', 'branch_visits', 'call_center_calls', 'complaints', 'digital_logins', 'rfm_score', 'cross_sell_index', 'churn_risk_score', 'net_profit']
2025-05-21 00:03:33,666 - INFO - Running bank_profitability_pipeline.py
2025-05-21 00:03:37,532 - INFO - Successfully completed bank_profitability_pipeline.py
2025-05-21 00:03:37,532 - INFO - Running visualize_results.py
2025-05-21 00:03:46,648 - INFO - visualize_results.py output: Starting visualization process...
2025-05-21 00:03:46,648 - INFO - visualize_results.py output: Loading data and models...
2025-05-21 00:03:46,648 - INFO - visualize_results.py output: Creating profit distribution visualizations...
2025-05-21 00:03:46,648 - INFO - visualize_results.py output: Creating feature relationship visualizations...
2025-05-21 00:03:46,650 - INFO - visualize_results.py output: Creating model performance visualizations...
2025-05-21 00:03:46,650 - INFO - visualize_results.py output: Creating executive dashboard...
2025-05-21 00:03:46,650 - INFO - visualize_results.py output: Visualizations complete. Results saved to results/plots
2025-05-21 00:03:46,650 - INFO - visualize_results.py output: Full results available in results
2025-05-21 00:03:46,650 - INFO - Successfully completed visualize_results.py
2025-05-21 00:03:46,651 - INFO - Pipeline completed successfully
